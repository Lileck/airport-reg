{% extends 'flights/base.html' %}

{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ä–µ–π—Å {{ flight.number }}{% endblock %}

{% block content %}
<div style="background: linear-gradient(135deg, #ff7675 0%, #fdcb6e 100%); color: white; padding: 25px; border-radius: 10px; margin: 20px 0;">
    <h1>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ä–µ–π—Å {{ flight.number }}</h1>
    <p><strong>–ú–∞—Ä—à—Ä—É—Ç:</strong> {{ flight.departure_city }} ‚Üí {{ flight.destination_city }}</p>
    <p><strong>–í—ã–ª–µ—Ç:</strong> {{ flight.departure_time|date:"d.m.Y H:i" }}</p>
    <p><strong>–í—ã—Ö–æ–¥:</strong> {{ flight.gate }}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status-{{ flight.status }}">{{ flight.get_status_display }}</span></p>
    <p><strong>–ê–≥–µ–Ω—Ç:</strong> {{ agent.workstation }} ({{ agent.agent_id }})</p>
</div>

{% if messages %}
    {% for message in messages %}
    <div style="background: {% if message.tags == 'success' %}#27ae60{% else %}#e74c3c{% endif %}; color: white; padding: 15px; border-radius: 5px; margin: 15px 0;">
        {{ message }}
    </div>
    {% endfor %}
{% endif %}

<!-- –ë–´–°–¢–†–´–ô –ü–û–ò–°–ö –ü–ê–°–°–ê–ñ–ò–†–û–í -->
<div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0;">
    <h2>üîç –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</h2>

    <form method="get" action="{% url 'flights:passenger_lookup' %}" style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: end;">
        <div>
            <label><strong>–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏ –∏–ª–∏ –ø–∞—Å–ø–æ—Ä—Ç—É:</strong></label>
            <input type="text" name="search" style="width: 100%; padding: 12px; margin: 5px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
        </div>
        <button type="submit" style="background: #e67e22; color: white; padding: 12px 25px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; height: fit-content;">
            üîç –ù–∞–π—Ç–∏
        </button>
    </form>

    <div style="margin-top: 15px; display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="{% url 'flights:passenger_lookup' %}?search=–ò–≤–∞–Ω" style="background: #f8f9fa; color: #666; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 14px;">
            –ò–≤–∞–Ω
        </a>
        <a href="{% url 'flights:passenger_lookup' %}?search=–ü–µ—Ç—Ä" style="background: #f8f9fa; color: #666; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 14px;">
            –ü–µ—Ç—Ä
        </a>
        <a href="{% url 'flights:passenger_lookup' %}?search=–ú–∞—Ä–∏—è" style="background: #f8f9fa; color: #666; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 14px;">
            –ú–∞—Ä–∏—è
        </a>
        <a href="{% url 'flights:passenger_lookup' %}?search=123" style="background: #f8f9fa; color: #666; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 14px;">
            –ü–∞—Å–ø–æ—Ä—Ç 123...
        </a>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 30px 0;">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ -->
    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2>üë• –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</h2>

        {% if available_passengers %}
        <form method="post">
            {% csrf_token %}

            <div style="margin-bottom: 20px;">
                <label><strong>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Å—Å–∞–∂–∏—Ä–∞:</strong></label>
                <select name="passenger_id" required style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Å—Å–∞–∂–∏—Ä–∞ --</option>
                    {% for passenger in available_passengers %}
                    <option value="{{ passenger.id }}">
                        {{ passenger.first_name }} {{ passenger.last_name }} (–ü–∞—Å–ø–æ—Ä—Ç: {{ passenger.passport_number }})
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 20px;">
                <label><strong>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ:</strong></label>
                <select name="seat_number" required style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ --</option>
                    {% for seat in available_seats %}
                    <option value="{{ seat }}">{{ seat }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" style="background: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%;">
                ‚úÖ –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨ –ü–ê–°–°–ê–ñ–ò–†–ê
            </button>
        </form>
        {% else %}
        <div style="background: #f8f9fa; padding: 30px; border-radius: 5px; text-align: center;">
            <h3 style="color: #27ae60;">üéâ –í—Å–µ –ø–∞—Å—Å–∞–∂–∏—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!</h3>
            <p>–ù–∞ —ç—Ç–æ–º —Ä–µ–π—Å–µ –Ω–µ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.</p>
        </div>
        {% endif %}
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Å—Å–∞–∂–∏—Ä–∞ -->
    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∞—Å—Å–∞–∂–∏—Ä–∞</h2>

        <form method="post">
            {% csrf_token %}

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div>
                    <label><strong>–ò–º—è:</strong></label>
                    <input type="text" name="new_first_name" required style="width: 100%; padding: 12px; margin: 5px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="–ò–≤–∞–Ω">
                </div>
                <div>
                    <label><strong>–§–∞–º–∏–ª–∏—è:</strong></label>
                    <input type="text" name="new_last_name" required style="width: 100%; padding: 12px; margin: 5px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="–ò–≤–∞–Ω–æ–≤">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label><strong>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞:</strong></label>
                <input type="text" name="new_passport" required style="width: 100%; padding: 12px; margin: 5px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="1234567890">
            </div>

            <div style="margin-bottom: 20px;">
                <label><strong>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ:</strong></label>
                <select name="new_seat_number" required style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ --</option>
                    {% for seat in available_seats %}
                    <option value="{{ seat }}">{{ seat }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" style="background: #27ae60; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%;">
                üöÄ –°–û–ó–î–ê–¢–¨ –ò –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨
            </button>
        </form>

        <div style="margin-top: 20px; padding: 15px; background: #e8f4fd; border-radius: 5px;">
            <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong>
            –ù–æ–≤—ã–π –ø–∞—Å—Å–∞–∂–∏—Ä –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ.
        </div>
    </div>
</div>

<!-- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä—ã -->
<div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0;">
    <h2>‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä—ã</h2>
    <div style="background: #e8f6f3; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
        <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ: <strong>{{ registered_count }}</strong> –∏–∑ <strong>{{ total_capacity }}</strong>
        (–°–≤–æ–±–æ–¥–Ω–æ: {{ available_seats|length }})
    </div>

    {% if boarded_passengers %}
    <div style="max-height: 400px; overflow-y: auto;">
        {% for boarding_pass in boarded_passengers %}
        <div style="border: 1px solid #e0e0e0; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8fff8; border-left: 4px solid #27ae60;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 8px 0; color: #2c3e50;">
                        {{ boarding_pass.passenger.first_name }} {{ boarding_pass.passenger.last_name }}
                    </h4>
                    <div style="font-size: 14px; color: #666;">
                        <strong>–ü–∞—Å–ø–æ—Ä—Ç:</strong> {{ boarding_pass.passenger.passport_number }}<br>
                        <strong>–ú–µ—Å—Ç–æ:</strong> <span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 3px; font-weight: bold;">{{ boarding_pass.seat_number }}</span><br>
                        <strong>–ü–æ—Å–∞–¥–æ—á–Ω—ã–π —Ç–∞–ª–æ–Ω:</strong> {{ boarding_pass.boarding_pass_number }}<br>
                        <strong>–í—ã—Ö–æ–¥:</strong> {{ boarding_pass.gate }}
                    </div>
                </div>
                <form method="post" action="{% url 'flights:cancel_registration' boarding_pass.id %}" style="margin: 0;">
                    {% csrf_token %}
                    <button type="submit" style="background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="background: #f8f9fa; padding: 30px; border-radius: 5px; text-align: center;">
        <p style="color: #666; margin: 0;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</p>
    </div>
    {% endif %}
</div>

<!-- –°—Ö–µ–º–∞ —Å–∞–ª–æ–Ω–∞ -->
<div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0;">
    <h2>üí∫ –°—Ö–µ–º–∞ —Å–∞–ª–æ–Ω–∞</h2>
    <div style="background: #2c3e50; padding: 20px; border-radius: 8px; margin: 15px 0;">
        <div style="color: white; text-align: center; margin-bottom: 15px; font-weight: bold;">–í—ã—Ö–æ–¥ {{ flight.gate }} ‚Üí</div>

        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; max-width: 400px; margin: 0 auto;">
            {% for seat in available_seats|slice:":30" %}
            <div style="background: #27ae60; color: white; padding: 12px; text-align: center; border-radius: 4px; font-size: 12px; font-weight: bold;">
                {{ seat }}
            </div>
            {% endfor %}

            {% for bp in boarded_passengers %}
            <div style="background: #e74c3c; color: white; padding: 12px; text-align: center; border-radius: 4px; font-size: 12px; font-weight: bold;">
                {{ bp.seat_number }}
            </div>
            {% endfor %}
        </div>
    </div>

    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 15px;">
        <div style="display: flex; align-items: center; gap: 5px;">
            <div style="width: 20px; height: 20px; background: #27ae60; border-radius: 3px;"></div>
            <span>–°–≤–æ–±–æ–¥–Ω–æ</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
            <div style="width: 20px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
            <span>–ó–∞–Ω—è—Ç–æ</span>
        </div>
    </div>
</div>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
    <a href="{% url 'flights:agent_dashboard' %}" style="background: #3498db; color: white; padding: 12px 25px; border-radius: 5px; text-decoration: none; font-weight: bold;">
        ‚Üê –ü–∞–Ω–µ–ª—å –∞–≥–µ–Ω—Ç–∞
    </a>
    <a href="{% url 'flights:flight_detail' flight.id %}" style="background: #9b59b6; color: white; padding: 12px 25px; border-radius: 5px; text-decoration: none; font-weight: bold;">
        ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–π—Å–µ
    </a>
    <a href="{% url 'flights:passenger_lookup' %}" style="background: #e67e22; color: white; padding: 12px 25px; border-radius: 5px; text-decoration: none; font-weight: bold;">
        üîç –ü–æ–∏—Å–∫ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
    </a>
    <a href="/admin/flights/passenger/add/" style="background: #95a5a6; color: white; padding: 12px 25px; border-radius: 5px; text-decoration: none; font-weight: bold;">
        ‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞
    </a>
</div>

<style>
.status-scheduled { color: #3498db; font-weight: bold; }
.status-boarding { color: #f39c12; font-weight: bold; }
.status-departed { color: #e74c3c; font-weight: bold; }
.status-landed { color: #27ae60; font-weight: bold; }
</style>
{% endblock %}